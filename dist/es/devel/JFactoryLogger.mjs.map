{"version":3,"file":"JFactoryLogger.mjs","sources":["../../../src/JFactoryLogger.mjs"],"sourcesContent":["import { JFACTORY_DEV, JFACTORY_CLI, JFACTORY_REPL } from \"./jFactory-env.mjs\";\nimport { jFactoryCfg } from \"./jFactory-env.mjs\";\nimport { JFactoryExpect } from \"./JFactoryExpect.mjs\";\nimport { helper_defaultsDeep, helper_isNative, NOOP } from \"./jFactory-helpers.mjs\";\n\n// ---------------------------------------------------------------------------------------------------------------------\n// JFactoryLogger 1.7\n// ---------------------------------------------------------------------------------------------------------------------\n// A contextual logger that prepends a label and allows runtime filtering while preserving the caller line number\n// ---------------------------------------------------------------------------------------------------------------------\n// logger.createSubLogger(label) create a sub-logger of logger; \"logger\" can be a sub-logger.\n// logger.disable() disable console for itself and sub-loggers\n// logger.disallow('log') disallow logger.log() only\n// logger.disallow('log', subLogger.label) disallow sub-logger.log() only. This is callable from any logger/sub-logger\n// ---------------------------------------------------------------------------------------------------------------------\n// Status : Beta\n// ---------------------------------------------------------------------------------------------------------------------\n\nconst SYMBOL_ENABLED = Symbol();\n\nexport class JFactoryLogger {\n\n    constructor(options) {\n        if (JFACTORY_DEV && options) {\n            JFactoryExpect(\"JFactoryLogger(options)\", options)\n                .properties(Object.getOwnPropertyNames(JFactoryLogger.DEFAULT_CONFIG))\n        }\n        helper_defaultsDeep(this, options, config);\n        this.installAccessor(\"log\");\n        this.installAccessor(\"warn\");\n        this.installAccessor(\"error\")\n    }\n\n    get enabled() {\n        return this[SYMBOL_ENABLED] && (this.parentLogger ? this.parentLogger.enabled : true)\n    }\n\n    set enabled(v) {\n        v ? this.enable() : this.disable()\n    }\n\n    enable() {\n        if (this[SYMBOL_ENABLED] !== true) {\n            this[SYMBOL_ENABLED] = true;\n        }\n    }\n\n    disable() {\n        if (this[SYMBOL_ENABLED] !== false) {\n            this[SYMBOL_ENABLED] = false;\n        }\n    }\n\n    disallow(nativeName, label = this.label) {\n        if (!this.filters[label]) {this.filters[label] = {}}\n        this.filters[label][nativeName] = true\n    }\n\n    allow(nativeName, label = this.label) {\n        if (this.filters[label]) {\n            delete this.filters[label][nativeName]\n        }\n    }\n\n    installAccessor(nativeName, targetName = nativeName, target = this) {\n        if (JFACTORY_DEV) {\n            JFactoryExpect(\"JFactoryLogger(nativeName)\", nativeName).equalIn([\"log\", \"warn\", \"error\"]);\n        }\n        Object.defineProperties(target, {\n            [targetName]: {\n                get: this.accessor.bind(this, nativeName/*, target*/),\n                configurable: true\n            }\n        })\n    }\n\n    accessor(nativeName/*, target*/) {\n        if (!this[SYMBOL_ENABLED]) {\n            return NOOP;\n        }\n        return this.condition(nativeName) && this.formatter[nativeName](this) || NOOP\n    }\n\n    createSubLogger(label) {\n        /** @type JFactoryLogger */\n        let sub = new JFactoryLogger({\n            enabled: this.enabled,\n            label: this.label + \".\" + label,\n            styles_css: this.styles_css,\n            styles_cli: this.styles_cli,\n            console: this.console,\n            formatter: this.formatter\n        });\n        sub.parentLogger = this;\n        sub.condition.addCondition(() => this.enabled);\n        sub.filters = this.filters; // shared to allow/disallow from anywhere\n        return sub\n    }\n}\n\n// #limitation# To preserve the line number, we can only use native functions, like bind\n// #limitation# Because we use bind(), only the style of the first element can be defined efficiently\n\nJFactoryLogger.FORMATTER_NATIVE = {\n    log: logger => logger.console.log.bind(logger.console, logger.label + \">\"),\n    warn: logger => logger.console.warn.bind(logger.console, logger.label + \">\"),\n    error: logger => logger.console.error.bind(logger.console, logger.label + \">\")\n};\n\nJFactoryLogger.FORMATTER_CLI = {\n    log: logger => logger.console.log.bind(logger.console, logger.styles_cli.label, logger.label + \">\"),\n    warn: logger => logger.console.warn.bind(logger.console, logger.styles_cli.label, logger.label + \">\"),\n    error: logger => logger.console.error.bind(logger.console, logger.styles_cli.label, logger.label + \">\")\n};\n\nJFactoryLogger.FORMATTER_BROWSER = {\n    log: logger => logger.console.log.bind(logger.console, \"%c\" + logger.label + \">\", logger.styles_css.label),\n    warn: logger => logger.console.warn.bind(logger.console, \"%c\" + logger.label + \">\", logger.styles_css.label),\n    error: logger => logger.console.error.bind(logger.console, \"%c\" + logger.label + \">\", logger.styles_css.label)\n};\n\n/** @return {boolean} */\nJFactoryLogger.DEFAULT_CONDITION = function(nativeName) {\n    if (JFACTORY_DEV) {\n        JFactoryExpect(\"JFactoryLogger.condition(nativeName)\", nativeName).equalIn([\"log\", \"warn\", \"error\"]);\n        JFactoryExpect(\"JFactoryLogger.enabled\", this.enabled).equal(true);\n    }\n    return !(this.filters[this.label] && this.filters[this.label][nativeName])\n};\n\nJFactoryLogger.DEFAULT_CONFIG = /** @lends JFactoryLogger# */ {\n    label: \"\",\n    enabled: true,\n    parentLogger: null,\n    condition: JFactoryLogger.DEFAULT_CONDITION,\n    formatter:\n        !helper_isNative(console.log) || JFACTORY_REPL ? JFactoryLogger.FORMATTER_NATIVE :\n            JFACTORY_CLI ? JFactoryLogger.FORMATTER_CLI :\n                JFactoryLogger.FORMATTER_BROWSER\n    ,\n    console,\n    filters: {\n    },\n    styles_cli: {\n        label: \"\\x1b[1;30m%s\\x1b[0m\"\n    },\n    styles_css: {\n        label: \"color: gray\"\n    }\n};\n\nconst config = jFactoryCfg(\"JFACTORY_CFG_JFactoryLogger\", JFactoryLogger.DEFAULT_CONFIG);"],"names":[],"mappings":"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"}