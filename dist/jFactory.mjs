/*!
 * jFactory v1.7.4
 * https://github.com/jfactory-es/jfactory
 *
 * Copyright (c) 2019, StÃ©phane Plazis
 * https://github.com/jfactory-es/jfactory/blob/master/LICENSE.txt
 */
import e from"lodash";import t from"jquery";const s="(custom build)",i=d("JFACTORY_ENV_CLI")??("object"==typeof process&&"object"==typeof process.versions&&process.versions.node),r=d("JFACTORY_ENV_DEV")??!0,n=d("JFACTORY_ENV_DEBUG")??!1,a=d("JFACTORY_ENV_LOG")??(r&&!i||n),o=d("JFACTORY_ENV_TRACE")??(r&&!i||n),l=d("JFACTORY_ENV_BOOT")??!0,c=d,h=function(e,t){void 0===u[e]?(u[e]=Object.assign({},t,globalThis[e]),delete globalThis[e]):void 0!==t&&(u[e]=!1!==t&&Object.assign(u[e],t));return u[e]},u={};function d(e){let t=globalThis[e];return delete globalThis[e],t}const p=t,f=e.isString,m=e.isNumber,$=e.isPlainObject,g=e.defaultsDeep,v=e.lowerFirst,b=e.get,E=e.template,A=e.camelCase,y=()=>{},S=(e,t)=>Object.defineProperty(t,"name",{value:e}),R=document.createElement("a"),_=e=>(R.href=e,R.href),O=function(e){return"function"==typeof e&&-1!==Function.prototype.toString.call(e).indexOf("[native code]")};function w(e){return globalThis.navigator&&globalThis.navigator.userAgent&&globalThis.navigator.userAgent.indexOf(e+"/")>0}const T=()=>new P;class P{constructor(){this._done=[],this._fail=[]}execute(e){for(let t of e)t();this.fulfilled=!0}resolve(){this.execute(this._done)}reject(){this.execute(this._fail)}done(e){this.fulfilled?e():this._done.push(e)}fail(e){this.fulfilled?e():this._fail.push(e)}}const L={name:"fetch",test:()=>fetch,info:"https://developer.mozilla.org/docs/Web/API/Fetch_API/Using_Fetch"},N={name:"Request",test:()=>Request,info:"https://developer.mozilla.org/docs/Web/API/Request"},j={name:"AbortController/AbortSignal",test:()=>(new AbortController).signal,info:"https://developer.mozilla.org/docs/Web/API/AbortController, https://developer.mozilla.org/docs/Web/API/AbortSignal"},I={name:"MutationObserver",test:()=>MutationObserver,info:"https://developer.mozilla.org/docs/Web/API/MutationObserver"};let F={};function k(...e){for(let t of e)F[t.name]=t}function C(){for(let[e,t]of Object.entries(F)){let s;try{s=Boolean(t.test())}catch(e){}s||console.warn(`jFactory may require the support of "${e}", ${t.info}`)}F=null}function M(e){if(!H){if(e&&!l)return;r&&(console.log("jFactory (custom build) running in development mode; performances will be affected"),!a&&console.log("jFactory: logs disabled"),C()),function(){if(x){for(let e of x)e();x=null}}(),H=!0}}let x=[];let B,H=!1;function U(){if(!H)throw new Error("jFactoryBootstrap() must be called before using jFactory")}function D(e){if(H)throw new Error("jFactoryBootstrap() already called");x.push(e)}class J{constructor(e="JFactoryTrace",t=!0,s=1/0){let i;s&&(i=Error.stackTraceLimit,Error.stackTraceLimit=s),this.source=new Error,this.omitAboveFunctionName=e,this.omitSelf=t,s&&(Error.stackTraceLimit=i),this.init()}init(){this.printable=this.source,this.asyncPrintable=Promise.resolve(this.printable)}static createErrorFromStack(e){let t=new Error;return t.name="JFactoryTrace",t.stack=e,t}}class Y extends J{init(){let e=e=>{this.printable=this.constructor.createErrorFromStack(this.createStackFromTraceFrames(this.filterTraceFrames(e)))};e(StackTrace.getSync(this.source,q.libOptions)),q.useSourcemap?this.asyncPrintable=StackTrace.fromError(this.source,q.libOptions).then(e):this.asyncPrintable=Promise.resolve(this.printable)}filterTraceFrames(e){if(this.omitAboveFunctionName){let t=e.findIndex((e=>e.functionName&&e.functionName.endsWith(this.omitAboveFunctionName)));t>0&&(this.omitSelf&&t++,e=e.slice(t))}return e}createStackFromTraceFrames(e){for(let t of Object.values(V.formatters))if(t.test())return t.format(e);return this.source.stack}}B=r&&o?{captureTraceSource:(e,t,s)=>new(q.tracer||J)(e,t,s),attachTrace(e,t,s=q.keys[0],i=q.keys[1],r=q.label){"object"!=typeof t&&(t=this.captureTraceSource(t||"attachTrace",!t));Object.defineProperty(e,s,{get:()=>console.log(t.printable)||r||"The stack has been printed in the console"}),Object.defineProperty(e,i,{value:t})},formatters:{webkit:{test:()=>w("Chrome"),format:e=>"Error (generated by JFactoryTrace)\n"+e.map((e=>{let t="\tat ",s=e.fileName+":"+e.lineNumber+":"+e.columnNumber;return e.functionName?t+=e.functionName+" ("+s+")":t+=s,t})).join("\n")},firefox:{test:()=>w("Gecko"),format:e=>e.map((e=>(e.functionName??"<anonymous>")+"@"+e.fileName+":"+e.lineNumber+":"+e.columnNumber)).join("\n")}}}:{captureTraceSource:y,attachTrace:y};const V=B,q=h("JFACTORY_CFG_JFactoryTrace");r&&o&&(q.keys=["$dev_traceLog","$dev_traceSource"],"object"==typeof StackTrace&&(q.tracer=Y,q.useSourcemap=!1),D((function(){q.tracer===Y&&console.log("JFactoryTrace: Stacktrace.js support enabled; performances will be affected")})));class W extends Error{constructor(e="unspecified error",t=null){t=Object.assign(Object.create(null),t),super(e=W.toPrintable(e,t)),this.$data=Object.assign(Object.create(null),t)}toString(){return this.message}*[Symbol.iterator](){yield this.message,yield this.$data}static getId(e){return e[te.keys.find((t=>{let s=b(e,t);return s||0===s}))]}static toPrintableData(e){const t={};let s;for(let[i,r]of Object.entries(e)){switch(typeof r){case"function":r=r.name+"()";break;case"object":if(null===r){r="null";break}if(r instanceof Error){r=r.toString();break}if(void 0!==(s=W.getId(r)))r='"'+s+'"';else if(O(r.toString))try{s=JSON.stringify(r),r=s.length>te.jsonMax?s.substring(0,te.jsonMax)+"[...]":s}catch(e){r="[object "+r.constructor.name+"]"}else r=r.toString();break;case"string":r='"'+r+'"';break;default:r=String(r)}t[i]=r}return t}static toPrintable(e,t){const s=[];for(let i of e.split(";")){let e,r=te.reg_placeholder;if(r.lastIndex=0,e=r.exec(i)){do{if(e[1]&&e[1]in t){s.push(i.trim());break}}while(null!==(e=r.exec(i)))}else s.push(i.trim())}return v(E(s.join("; "))(W.toPrintableData(t)))}static factory(e,t){let s={[e]:class extends W{constructor(e,s){super(t,e),V.attachTrace(this.$data,s)}}}[e];return s.prototype.name="Error JFACTORY_ERR_"+e,s}}const G=W.factory,z=G("INVALID_VALUE","invalid value for ${target}; Reason: ${reason}; Given: ${given}"),Q=G("INVALID_CALL","invalid call ${target}; Reason: ${reason}; Owner: ${owner}"),K=G("PROMISE_EXPIRED","expired promise ${target}; Reason: ${reason}"),X=G("REQUEST_ERROR","error requesting ${target}; Reason: ${reason}; Owner: ${owner}"),Z=G("KEY_DUPLICATED","duplicated key for ${target}; Given: ${given}"),ee=G("KEY_MISSING","missing key for ${target}; Given: ${given}"),te=h("JFACTORY_CFG_JFactoryError",{reg_placeholder:/\${([^}]+)}/g,jsonMax:40,keys:["$.about.name","$dev_name","$name","name","id"]});function se(e,t){if(r&&U(),!new.target)return new se(e,t);this.label=e,this.value=t}const ie=function(e,t,s){throw new z({target:e,reason:s,given:t})},re={notUndefined:(e,t)=>(void 0===t&&ie(e,t,"cannot be undefined"),!0),notEmptyString:(e,t)=>(""===t&&ie(e,t,"cannot be empty string"),!0),notFalsy:(e,t)=>(t||ie(e,t,'cannot be a falsy value (undefined, null, NaN, 0, "")'),!0),validSpaces:(e,t)=>(t.replace&&t.replace(/\s+/g," ").trim()===t||ie(e,t,"invalid space delimiters"),!0),matchReg:(e,t,s)=>(s.test(t)||ie(e,t,'string "'+t+'" must match '+s),!0),type(e,t,...s){let i,r=!1;for(let n of s){null===n?i="Null":"name"in n&&(i=n.name);let s=re["type"+i];if(s)try{r=s(e,t)}catch(e){}else r=t instanceof n;if(r)break}return r||ie(e,t,"must be an instance of ["+s.map((e=>e.name)).join(", ")+"]"),!0},typeNull:(e,t)=>(null!==t&&ie(e,t,"must be null"),!0),typeBoolean:(e,t)=>(!0!==t&&!1!==t&&ie(e,t,"must be a boolean"),!0),typeString:(e,t)=>(f(t)||ie(e,t,"must be a string"),!0),typeNumber:(e,t)=>(m(t)||ie(e,t,"must be a number"),!0),typeFunction:(e,t)=>("function"!=typeof t&&ie(e,t,"must be a function"),!0),typePlainObject:(e,t)=>($(t)||ie(e,t,"must be a plain object"),!0),equal(e,t,...s){let i=!1;for(let e of s)if(i=t===e)break;return i||ie(e,t,"must be one of ["+s+"]"),!0},equalIn:(e,t,s)=>(Array.isArray(s)||(s=Object.values(s)),s.includes(t)||ie(e,t,"must be one from ["+s.join(", ")+"]"),!0),properties(e,t,s){for(let i of Object.getOwnPropertyNames(t))se(e+', property name "'+i+'"',i).equalIn(s);return!0},writable:(e,t,s)=>(Object.getOwnPropertyDescriptor(t,s).writable||ie(e,t,"must be writable"),!0),notWritable:(e,t,s)=>(Object.getOwnPropertyDescriptor(t,s).writable&&ie(e,t,"must not be writable"),!0),enumerable:(e,t,s)=>(Object.prototype.propertyIsEnumerable.call(t,s)||ie(e,t,"must be enumerable"),!0),notEnumerable:(e,t,s)=>(Object.prototype.propertyIsEnumerable.call(t,s)&&ie(e,t,"must not be enumerable"),!0),configurable:(e,t,s)=>(Object.getOwnPropertyDescriptor(t,s).configurable||ie(e,t,"must be configurable"),!0),notConfigurable:(e,t,s)=>(Object.getOwnPropertyDescriptor(t,s).configurable&&ie(e,t,"must not be configurable"),!0),reservedProperty:(e,t,s)=>(s in t&&ie(e,t,"is a reserved property"),!0)};D((function(){Object.assign(se,re);for(const e of Object.getOwnPropertyNames(re))se.prototype[e]=function(...t){return se[e](this.label,this.value,...t),this}}));class ne{static createDescriptors(e=ne.DESCRIPTORS_PROTOTYPE){let t=ne.create(e,!0,!0),s=Object.create(null);return s.NONE=t(),s.WRITABLE=t({writable:!0}),s.ENUMERABLE=t({enumerable:!0}),s.CONFIGURABLE=t({configurable:!0}),s.CONFIGURABLE_WRITABLE=s.WRITABLE_CONFIGURABLE=t({writable:!0,configurable:!0}),s.CONFIGURABLE_ENUMERABLE=s.ENUMERABLE_CONFIGURABLE=t({enumerable:!0,configurable:!0}),s.ENUMERABLE_WRITABLE=s.WRITABLE_ENUMERABLE=t({writable:!0,enumerable:!0}),s.WRITABLE_ENUMERABLE_CONFIGURABLE=s.WRITABLE_CONFIGURABLE_ENUMERABLE=s.ENUMERABLE_CONFIGURABLE_WRITABLE=s.ENUMERABLE_WRITABLE_CONFIGURABLE=s.CONFIGURABLE_WRITABLE_ENUMERABLE=s.CONFIGURABLE_ENUMERABLE_WRITABLE=t({writable:!0,enumerable:!0,configurable:!0}),s.READONLY=t({writable:!1,enumerable:!1,configurable:!1}),s}static assign(e,t,s,i){let r={};switch(typeof t){case"string":case"symbol":if(!i)throw new Error("missing descriptor argument; use Object.assign instead");(i=Object.create(i)).value=s,Object.defineProperty(e,t,i);break;case"object":if([s,i]=[t,s],!i)throw new Error("missing descriptor argument; use Object.assign instead");for(let e of Object.getOwnPropertyNames(s))r[e]=Object.create(i),r[e].value=s[e];for(let e of Object.getOwnPropertySymbols(s))r[e]=Object.create(i),r[e].value=s[e];Object.defineProperties(e,r);break;default:throw new Error("invalid property argument")}return e}static create(e,t=!1,s=!1){return function(i){return t?Object.assign(s?Object.create(null):{},e,i):Object.assign(Object.create(s?Object.assign(Object.create(null),e):e),i)}}static disinherit(e){return Object.assign(Object.create(null),e)}}ne.DESCRIPTORS_PROTOTYPE={writable:!1,enumerable:!1,configurable:!1},D((function(){ne.descriptors=ne.createDescriptors()}));const ae=()=>++ae.uid;ae.uid=0;class oe{constructor(e,t={}){let s,i;r&&(se("JFactoryAbout(owner)",e).type(Object),se("JFactoryAbout(about)",t).typePlainObject().reservedProperty("uid").reservedProperty("fingerprint"),"name"in t&&se("JFactoryAbout(about.name)",t.name).typeString().notEmptyString());let n=ae();t.name?(s=t.name,delete t.name,i="jFactory_"+A(s.toLowerCase())+"_"+n):(delete t.name,s=`[${e.constructor.name}#${n}]`,i="jFactory_"+e.constructor.name+"_"+n),ne.assign(this,{uid:n,name:s,fingerprint:i},ne.descriptors.ENUMERABLE),Object.assign(this,t),r&&(se("JFactoryAbout.name",this.name).matchReg(/^[\w[\]#]+$/),se("JFactoryAbout.fingerprint",this.fingerprint).matchReg(/^[\w]+$/))}}const le=()=>++le.uid;le.uid=0;class ce extends Promise{constructor({name:e,config:t,traceSource:s},i){r&&U(),1===arguments.length&&([e,t,i]=[null,null,arguments[0]]);const n=le();let a,o;t={...ce.DEFAULT_CONFIG,...t},e=e||"unnamed",r&&(se("name",e).type(String,Number).matchReg(/^[^. ]+$/),se("config",t).typePlainObject(),se("executor",i).typeFunction()),super(((e,t)=>{a=e,o=t}));const l=new he(this,n,e,t);Object.defineProperties(this,{$chain:{enumerable:!0,writable:!0,value:l},$type:{writable:!0,value:"promise"},$value:{writable:!0,value:void 0},$isSettled:{writable:!0,value:!1},$isRejected:{writable:!0,value:null},$isFulfilled:{writable:!0,value:null},$isExpired:{writable:!0,value:!1},$isAborted:{writable:!0,value:!1}}),r&&(Object.defineProperties(this,{$dev_name:{configurable:!0,value:e+"["+n+":0]"},$dev_path:{writable:!0,value:new ue(this)},$dev_position:{writable:!0,value:0}}),O(i)||Object.defineProperties(this,{$dev_source:{value:i}}),V.attachTrace(this,s));const c=()=>{if(!this.$chain.isPending)try{this.$chainComplete("auto-completed")}catch(e){console.error(e)}},h=e=>{if(!this.$isSettled){if(e===this)return void u(new TypeError("Chaining cycle detected for promise "+this.$dev_name));let t;if(null!==e&&("object"==typeof e||"function"==typeof e))try{t=e.then}catch(e){return void u(e)}if("function"==typeof t){let s=!1,i=function(e){s||(s=!0,h(e))},r=function(e){s||(s=!0,u(e))};try{t.call(e,i,r)}catch(e){s||u(e)}}else this.$isRejected=!1,this.$isFulfilled=!0,this.$isExpired&&(e=this.$chain.errorExpired),a(e),d(e)}},u=e=>{this.$isSettled||(this.$isRejected=!0,this.$isFulfilled=!1,o(e),d(e))},d=e=>{this.$value=e,this.$isSettled=!0,this.$chain.chainMap.set(this,!0),this.$chain.chainConfig.chainAutoComplete&&(1!==this.$chain.chainMap.size||this.$isExpired?c():this.then(c))};let p=t.chainAutoComplete;Object.defineProperty(t,"chainAutoComplete",{get:()=>p,set:e=>{p!==e&&(p=e,e&&c())}}),l.chainMap.set(this,!1),Object.defineProperties(this,{__resolve__:{value:h},__reject__:{value:u}});try{i(h,u)}catch(e){u(e)}}then(e,t,s){let i,n,a,o=s||(O(e)&&!e.name.startsWith("bound ")&&O(t)&&!t.name.startsWith("bound ")?"await":void 0===e?"catch":"then");if(e&&"function"==typeof e&&(i=function(s){return"await"===o?a.$isAborted?t(a.$chain.errorExpired):e(s):a.$isExpired?void 0:(a.$isSettled,e(s))}),t&&"function"==typeof t&&(n=function(e){return a.$isSettled,t(e)}),a=Object.assign(super.then(i,n),this),le.uid--,a.$type=o,Object.defineProperties(a,{__onFulfilled__:{value:e},__onRejected__:{value:t}}),r){a.$dev_position=this.$chain.chainMap.size;let s="";e&&e.name&&(s+=e.name),t&&t.name&&(s+=","+t.name),Object.defineProperties(a,{$dev_name:{value:this.$chain.chainName+"["+this.$chain.chainId+":"+this.$dev_position+"]."+a.$type+(s?"("+s+")":"")+"["+a.$chain.chainId+":"+a.$dev_position+"]"},$dev_path:{value:new ue(this.$dev_path,a)}})}return a.$chain.chainMap.set(a,!1),this.$isExpired&&ce.setExpired(a,this.$isAborted,!0),a}static resolve(e,t){return 1===arguments.length&&([e,t]=[{},e]),e||(e={}),t instanceof this&&1===arguments.length?t:new this(e,(function(e){e(t)}))}static reject(e,t){return 1===arguments.length&&([e,t]=[{},e]),e||(e={}),new this(e,(function(e,s){s(t)}))}$thenIfExpired(e){return this.then((t=>this.$chain.chainRoot.$isExpired?e(t):t),void 0,"$thenIfExpired")}$chainAbort(e="$chainAbort()"){return this.$chain.complete(e,!0),this}$chainComplete(e="$chainComplete()"){if(this.$chain.isPending)throw new Q({target:this,reason:"Trying to complete a pending chain. Use $chainAbort() if you want to stop it."});return this.$chain.complete(e,!1),this}$chainAutoComplete(){return this.$chain.chainConfig.chainAutoComplete=!0,this}static setExpired(e,t,s){if(e.$isExpired=!0,!e.$isSettled){if("$thenIfExpired"===e.$type)e.__onFulfilled__(e.$chain.chainRoot.$chain.errorExpired);else if(t)e.$isAborted=!0;/*!silent;*/else if(!s)throw new Q({target:e,reason:"promise must be aborted or settled before setting it to expired."});e.__resolve__()}}}ce.DEFAULT_CONFIG={chainAutoComplete:!1};class he{constructor(e,t,s,i){Object.defineProperties(this,{chainConfig:{value:i},chainRoot:{value:e},chainId:{value:t},chainName:{value:s},chainMap:{value:new Map},isCompleted:{value:!1,configurable:!0},data:{value:{}},__deferred__:{value:T()}})}get isPending(){return Array.from(this.chainMap.values()).includes(!1)}then(e){return this.__deferred__.done(e),this}complete(e="chain.complete()",t){let s=this.chainRoot;if(!s.$isExpired){s.$chain.errorExpired=new K({target:s,reason:e});let i=this.chainMap;for(let e of i.keys())ce.setExpired(e,t);Object.defineProperty(this,"isCompleted",{value:!0}),this.__deferred__.resolve()}return this}}class ue extends Array{constructor(){super();for(let e of arguments)Array.isArray(e)?this.push(...e):this.push(e)}get printable(){return this.map(((e,t)=>0===t?e.$dev_name:e.$dev_name.split(".")[1])).join(".")}toString(){return this.printable}}class de extends Promise{constructor(e){let t={$isSettled:!1,$isRejected:null,$value:void 0};super(((s,i)=>{let r=!1,n=e=>{e instanceof Promise?de.resolve(e).then(n,a):r||(r=!0,t.$isSettled=!0,t.$isRejected=!1,t.$value=e,s(e))},a=e=>{r||(r=!0,t.$isSettled=!0,t.$isRejected=!0,t.$value=e,i(e))};try{e(n,a)}catch(e){a(e)}})),Object.assign(this,t),t=this}then(e,t){if(this.$isSettled){let s=this.$value;try{if(this.$isRejected){if(super.then(void 0,(()=>null)),!t||"function"!=typeof t)return de.reject(s);s=t(s)}else e&&"function"==typeof e&&(s=e(s))}catch(e){return de.reject(e)}return de.resolve(s)}return super.then(e,t)}static resolve(e){return e instanceof de?e:new de(e instanceof Promise?e.then.bind(e):t=>t(e))}}class pe{constructor(){this.handlers=Object.create(null)}*[Symbol.iterator](e=[]){e.length||(e=Object.keys(this.handlers)),e.length||(e=["default"]);for(let t of e)t in this.handlers&&(yield*this.handlers[t])}first(e,t){return 1===arguments.length&&([e,t]=["default",e]),(this.handlers[e]||(this.handlers[e]=[])).unshift(t),this}last(e,t){return 1===arguments.length&&([e,t]=["default",e]),(this.handlers[e]||(this.handlers[e]=[])).push(t),this}compose(...e){let t=this,s=function(){let s={canceled:!1,parameters:Array.from(arguments),result:void 0},i=t[Symbol.iterator](e),r=i.next();return pe.composite_iterator(this,s,r,i)};return s.composer=t,s}static composite_iterator(e,t,s,i){let r,n;for(;!t.canceled&&!s.done;)if(r=s.value,n=e?r.call(e,t,...t.parameters):r(t,...t.parameters),s=i.next(),n instanceof Promise){if(!s.done||n.constructor===Promise)return n.then(S([r.name,"[compositeAsyncHandler]"].filter(Boolean).join(" "),(function(r){return t.result=r,pe.composite_iterator(e,t,s,i)})));t.result=n}else t.result=n;return t.result}}function fe(e){return new me(e).compose()}class me{constructor(e){this.originalHandler=e,this.expiredCalls=0,this.composer=new pe;let t,s=this.composer.compose("conditions"),i=this;this.isExpired=e=>t||s.call(e)||!1,this.setExpired=e=>t=e?e instanceof Error?e:new Q({target:this.originalHandler,reason:"manually expired"}):Boolean(this.expiredCalls=0),this.addExpireCondition=function(e){this.composer.last("conditions",(function(t){let s=function(s){return r&&se("JFactoryFunctionExpirable.addExpireCondition(), result",s).type(Boolean,Error),i.setExpired(!!s&&((t.canceled=!0)&&(s instanceof Error?s:new Q({target:i.originalHandler,reason:"conditionally expired",condition:e}))))},n=e.apply(this,t.parameters);return n instanceof Promise?n.then(s):s(n)}))}}compose(){let e=this,t=function(){let t=e.isExpired(this),s=e.constructor.call.bind(void 0,e,this,arguments);return t instanceof Promise?t.then(s):s(t)};return Object.assign(t,{expirable:this,isExpired:e=>this.isExpired(e),setExpired:e=>this.setExpired(e),addExpireCondition:e=>(this.addExpireCondition(e),t)})}static call(e,t,s,i){return i?e.onExpired(i):e.onNotExpired(t,s)}onExpired(e){return this.expiredCalls<me.MaxWarningExpiration&&(this.expiredCalls++,a&&console.warn(...new Q({...e.$data,reason:e.$data.reason+"; expiredCalls="+this.expiredCalls+(this.expiredCalls===me.MaxWarningExpiration?"; Max Warning Exceeded":"")}))),e}onNotExpired(e,t){return this.originalHandler.apply(e,t)}}function $e(e){return new ge(e).compose()}me.MaxWarningExpiration=10;class ge{constructor(e){this.originalHandler=e,this.composer=new pe,this.composer.first("original",S([e.name,"[condition]"].filter(Boolean).join(" "),(function(t){return e.apply(this,t.parameters)})))}compose(){let e=this.composer.compose("conditions","original");return Object.assign(e,{conditional:this,addCondition:t=>(this.addCondition(t),e)})}addCondition(e){this.composer.last("conditions",(function(t){let s=function(e){r&&se("JFactoryFunctionConditional.addCondition(), result",e).typeBoolean(),!e&&(t.canceled=!0)},i=e.apply(this,t.parameters);return i instanceof Promise?i.then(s):s(i)}))}}function ve(e){return new be(e).compose()}class be{constructor(e){this.originalHandler=e,this.composer=new pe,this.composer.first("original",S([e.name,"[wrapped]"].filter(Boolean).join(" "),(function(t){return e.apply(this,t.parameters)})))}compose(){let e=this.composer.compose("before","original","after");return Object.assign(e,{wrappable:this,beforeAll:t=>(this.beforeAll(t),e),justBefore:t=>(this.justBefore(t),e),justAfter:t=>(this.justAfter(t),e),afterAll:t=>(this.afterAll(t),e)})}beforeAll(e){this.composer.first("before",e)}justBefore(e){this.composer.last("before",e)}justAfter(e){this.composer.first("after",e)}afterAll(e){this.composer.last("after",e)}}class Ee{constructor(){Object.defineProperties(this,{registry:{value:p(Object.create(null))},handlers:{value:new WeakMap},onListenerUpdate:{value:null,writable:!0},onObserverUpdate:{value:null,writable:!0}})}on({events:e,handler:t,target:s,selector:i}){r&&(Ee.validateSelector(e),se("JFactoryEvents.on({handler})",t).typeFunction(),s&&se("JFactoryEvents.on({target})",s).type(String,p,HTMLElement),i&&se("JFactoryEvents.on({selector})",s).typeString());let n=this.handlers.get(t);s?(n||this.handlers.set(t,!0),i?p(s).on(e,i,t):p(s).on(e,t),this.onListenerUpdate&&this.onListenerUpdate(arguments)):(n||(this.handlers.set(t,n=function(e,{data:s,stack:i}){i.push((()=>t(e,s)))}),n.originalHandler=t),this.registry.on(e,n),this.onObserverUpdate&&this.onObserverUpdate(arguments))}off({events:e,handler:t,target:s,selector:i}){if(r&&void 0!==e&&(Ee.validateSelector(e),t&&se("JFactoryEvents.off({handler})",t).typeFunction(),s&&se("JFactoryEvents.off({target})",s).type(String,p,HTMLElement),i&&se("JFactoryEvents.off({selector})",s).typeString()),s)i?p(s).off(e,i,t):p(s).off(e,t);else{if(p("*").off(e,t),t&&!(t=this.handlers.get(t)))throw new z({target:"handler",reason:"not registered",given:t});this.registry.off(e,t)}this.onObserverUpdate&&this.onObserverUpdate(arguments),this.onListenerUpdate&&this.onListenerUpdate(arguments)}triggerParallel({events:e,data:t,target:s}){r&&(Ee.validateSelector(e),s&&se("JFactoryEvents.triggerParallel({target})",s).type(String,p,HTMLElement));const i=[],n=[];if(e=e.split(" "),s)for(let r of e)p(s).trigger(r,{data:t,stack:i});else for(let s of e)this.registry.triggerHandler(s,{data:t,stack:i});for(let e of i){let t=e();t instanceof Promise&&!t.$isSettled&&n.push(t)}return n.length?Promise.all(n):de.resolve()}triggerSeries({events:e,data:t,target:s}){return r&&(Ee.validateSelector(e),s&&se("JFactoryEvents.triggerSeries({target})",s).type(String,p,HTMLElement)),new de((async i=>{const r=[];if(e=e.split(" "),s)for(let i of e)p(s).trigger(i,{data:t,stack:r});else for(let s of e)this.registry.triggerHandler(s,{data:t,stack:r});for(let e of r){let t=e();t instanceof Promise&&!t.$isSettled&&await t}i()}))}}class Ae extends Ee{constructor(e){super(),Object.defineProperties(this,{parent:{value:e},affiliateRules:{value:(new pe).compose()}}),this.affiliateAddRule(Ae.rule_namespace)}affiliate(e="",t="",s){let i=new ye(e);for(let e of i.events)this.affiliateRules(e,t,s);return i.toString()}affiliateAddRule(e){this.affiliateRules.composer.last(e)}static rule_namespace(e,t,s){s=s.split(".");for(let e of s)e&&t.addNamespace(e)}on(e,t,s,i,r){switch(arguments.length){case 2:[i,t]=[t];break;case 3:"function"==typeof arguments[2]?[i,s]=[s]:[i,r,t,s]=[t,s];break;case 4:"object"==typeof arguments[3]&&([r,i,s]=[i,s])}e=this.affiliate(e,this.parent.$.about.fingerprint,r),void 0===t?super.on({events:e,handler:i}):super.on({events:e,target:t,selector:s,handler:i})}off(e,t,s,i,r){const n=arguments.length;switch(n){case 1:"object"==typeof arguments[0]&&([r,e]=[e]);break;case 2:"function"==typeof arguments[1]?[i,t]=[t]:$(arguments[1])&&([r,t]=[t]);break;case 3:"function"==typeof arguments[2]?[i,s]=[s]:"function"==typeof arguments[1]&&([i,r,t,s]=[t,s]);break;case 4:"object"==typeof arguments[3]&&([r,i,s]=[i,s])}e=this.affiliate(e,this.parent.$.about.fingerprint,r),n<2?super.off({events:e}):t?super.off({events:e,target:t,selector:s,handler:i}):super.off({events:e,handler:i})}trigger(e,t,s){switch(arguments.length){case 2:"object"!=typeof t||t.jquery||([s,t]=[t])}return t?super.triggerSeries({events:e,target:t,data:s}):super.triggerSeries({events:e,data:s})}triggerParallel(e,t,s){switch(arguments.length){case 2:"object"!=typeof t||t.jquery||([s,t]=[t])}return t?super.triggerParallel({events:e,target:t,data:s}):super.triggerParallel({events:e,data:s})}getDomListeners(e){let t=new Map;for(let s of p("*")){let i=p._data(s,"events");if(i)for(let r of Object.values(i))for(let i of r){let r;if(new Se(i.namespace).hasNamespace(e)){(r=t.get(s))||t.set(s,r={}),(r[i.type]||(r[i.type]=[])).push({selector:i.selector||null,handler:i.handler,namespace:i.namespace})}}}return t}getObservers(){let e=new Map,t=this.registry._events;if(!t){let e=Object.values(this.registry)[0],s=Object.getOwnPropertyNames(e).find((e=>0===e.indexOf("jQuery")));e&&s&&(t=this.registry._events=e[s].events)}if(t)for(let[s,i]of Object.entries(t)){let t=e.get(s);t||(t=[],e.set(s,t));for(let e of i)t.push({handler:e.handler.originalHandler,namespace:e.namespace})}return e}}class ye{constructor(e){r&&Ee.validateSelector(e),this.events=e.split(" ").map((e=>new Se(e)))}toString(){let e=[];for(let t of this.events)e.push(t.toString());return e.join(" ")}}class Se{constructor(e){let[t,...s]=e.split(".");this.event=t,this.namespace=new Set(s)}hasNamespace(e){Array.isArray(e)||(e=[e]);for(let t of e){if(r&&!/^[\w:]+$/.test(t))throw new z({target:"namespace",reason:"must be alphanumeric, underscore and colon characters",given:t});if(t&&this.namespace.has(t))return t}return!1}addNamespace(e){if(r&&!/^[\w:]+$/.test(e))throw new z({target:"namespace",reason:"must be alphanumeric, underscore and colon characters",given:e});this.namespace.add(e)}deleteNamespace(e){if(r&&!/^[\w:]+$/.test(e))throw new z({target:"namespace",reason:"must be alphanumeric, underscore and colon characters",given:e});this.namespace.delete(e)}toString(){return this.namespace.size?this.event+"."+Array.from(this.namespace.values()).join("."):this.event}}r&&(Ee.validateSelector=function(e){r&&se("JFactoryEvents.validateSelector(selector)",e).notUndefined().validSpaces();for(let[t,s]of e.split(" ").map((e=>e.split("."))).map((e=>[e.shift(),e.join(".")])))t&&Ee.validateEvent(t),s&&Ee.validateNamespace(s);return!0},Ee.validateEvent=function(e){if(r&&se("JFactoryEvents.validateEvent(event)",e).notUndefined().notEmptyString().validSpaces(),!/^[\w:]+$/.test(e))throw new z({target:"JFactoryEvents.validateEvent(event)",reason:"must be alphanumeric, underscore and colon characters",given:e});return!0},Ee.validateNamespace=function(e){if(r&&se("JFactoryEvents.validateNamespace(namespace)",e).notUndefined().notEmptyString().validSpaces(),!/^[\w:.]+$/.test(e))throw new z({target:"JFactoryEvents.validateNamespace(namespace)",reason:"must be alphanumeric, underscore, dot and colon characters",given:e});return!0});class Re extends ce{constructor(e,t,s={}){if("function"==typeof e)super(e);else{"string"==typeof e&&([e,t,s]=[{},arguments[0],arguments[1]]);let i=new Request(t,s);super(e,((r,n)=>{let a=fetch(i).then((e=>{if(this.$chain.fetchResponse=e,!e.ok)throw Error(e.status+":"+e.statusText);return e}));s.$typeText?a=a.then((e=>e.text())).then((e=>this.$chain.responseText=e)):s.$typeJSON&&(a=a.then((e=>e.json())).then((e=>this.$chain.responseJSON=e))),a=a.catch((r=>{throw new X({reason:r.message||r,target:this.$chain.fetchResponse&&this.$chain.fetchResponse.url||t,owner:this,fetchOptions:s,fetchRequest:i,fetchResponse:this.$chain.fetchResponse||null},e.traceSource)})),a.then(r,n)})),this.$chain.fetchOptions=s,this.$chain.fetchRequest=i;let r=s.abortController||new AbortController;s.signal=r.signal,this.$chain.fetchAbortController=r}}$chainAbort(e="request aborted"){return super.$chainAbort(e),this.$chain.fetchAbortController.abort(),this}}const _e=Symbol();class Oe{constructor(e){r&&e&&se("JFactoryLogger(options)",e).properties(Object.getOwnPropertyNames(Oe.DEFAULT_CONFIG)),g(this,e,we),this.installAccessor("log"),this.installAccessor("warn"),this.installAccessor("error")}get enabled(){return this[_e]&&(!this.parentLogger||this.parentLogger.enabled)}set enabled(e){e?this.enable():this.disable()}enable(){!0!==this[_e]&&(this[_e]=!0)}disable(){!1!==this[_e]&&(this[_e]=!1)}disallow(e,t=this.label){this.filters[t]||(this.filters[t]={}),this.filters[t][e]=!0}allow(e,t=this.label){this.filters[t]&&delete this.filters[t][e]}installAccessor(e,t=e,s=this){r&&se("JFactoryLogger(nativeName)",e).equalIn(["log","warn","error"]),Object.defineProperties(s,{[t]:{get:this.accessor.bind(this,e),configurable:!0}})}accessor(e){return this[_e]&&this.condition(e)&&this.formatter[e](this)||y}createSubLogger(e){let t=new Oe({enabled:this.enabled,label:this.label+"."+e,styles_css:this.styles_css,styles_cli:this.styles_cli,console:this.console,formatter:this.formatter});return t.parentLogger=this,t.condition.addCondition((()=>this.enabled)),t.filters=this.filters,t}}Oe.FORMATTER_NATIVE={log:e=>e.console.log.bind(e.console,e.label+">"),warn:e=>e.console.warn.bind(e.console,e.label+">"),error:e=>e.console.error.bind(e.console,e.label+">")},Oe.FORMATTER_CLI={log:e=>e.console.log.bind(e.console,e.styles_cli.label,e.label+">"),warn:e=>e.console.warn.bind(e.console,e.styles_cli.label,e.label+">"),error:e=>e.console.error.bind(e.console,e.styles_cli.label,e.label+">")},Oe.FORMATTER_BROWSER={log:e=>e.console.log.bind(e.console,"%c"+e.label+">",e.styles_css.label),warn:e=>e.console.warn.bind(e.console,"%c"+e.label+">",e.styles_css.label),error:e=>e.console.error.bind(e.console,"%c"+e.label+">",e.styles_css.label)},Oe.DEFAULT_CONDITION=function(e){return r&&(se("JFactoryLogger.condition(nativeName)",e).equalIn(["log","warn","error"]),se("JFactoryLogger.enabled",this.enabled).equal(!0)),!(this.filters[this.label]&&this.filters[this.label][e])},Oe.DEFAULT_CONFIG={label:"",enabled:!0,parentLogger:null,condition:Oe.DEFAULT_CONDITION,formatter:i?Oe.FORMATTER_CLI:Oe.FORMATTER_BROWSER,console:console,filters:{},styles_cli:{label:"[1;30m%s[0m"},styles_css:{label:"color: gray"}};const we=h("JFACTORY_CFG_JFactoryLogger",Oe.DEFAULT_CONFIG);class Te extends Date{toString(){return this.toLocaleTimeString()+", "+this.getUTCMilliseconds()+"ms ("+this.valueOf()+")"}$toDurationString(){let e=this.getUTCHours(),t=this.getUTCMinutes(),s=this.getUTCSeconds(),i=this.getUTCMilliseconds(),r=[];return e&&r.push(e+"h"),t&&r.push(t+"min"),s&&r.push(s+"s"),r.push(i+"ms"),1===r.length?r[0]:r.join(",")+" ("+this.valueOf()+")"}}class Pe extends Date{constructor(){super(),this.elapsed=null,Object.defineProperties(this,{t1:{value:null,writable:!0},t0:{value:new Te}})}end(){this.t1=new Te,this.elapsed=new Te(this.t1-this.t0).$toDurationString()}toString(){return this.elapsed}}class Le{constructor(e,t,s={}){this.callerInstance=e,this.callerConstructor=t,this.options=s}use(e,...t){r&&se("JFactoryTraits(trait)",e).typeFunction();let{callerInstance:s,callerConstructor:i}=this,n=Le.CACHE.get(s);if(n){if(n.has(e))return a&&console.warn(`${e.name} already called on`,s),this;n.add(e)}else Le.CACHE.set(s,new WeakSet([e]));!i.JFactoryTrait&&(i.JFactoryTrait=new WeakSet),i.JFactoryTrait.has(e)||(i.JFactoryTrait.add(e),this.export(e.prototype,i.prototype),this.export(e,i,!0));let o=new e(s,...t);return o.trait_constructor&&o.trait_constructor.apply(s,t),this}export(e,t,s){let i=Object.getOwnPropertyDescriptors(e);for(let r of Object.keys(i)){let n=Le.getPrefix(r);if(Le.getTarget(r,t,n)){let n=i[r],a=(this.options.parser||Le.defaultParser)(r,n,e,t,s);a&&(({propertyName:r,propertyDescriptor:n}=a),Object.defineProperty(t,r,n))}}}static defaultParser(e,t,s,i,r){let n=t.value;return r?null:e in i?(a&&console.warn(`${i.constructor.name}> skipping export of existing property "${e}"`,n),null):"object"==typeof n?(a&&console.warn(`${i.constructor.name}> skipping export of shared object "${e}"`,n),null):{propertyName:e,propertyDescriptor:t}}static getPrefix(e){let t=e.split("_");return t.length>1?t[0]:null}static getTarget(e,t,s){return Le.EXCLUDES.includes(e)||"trait"===s?null:t}}function Ne(e,t){return new Le(e,t,{parser(e,t){let s=Le.defaultParser(...arguments);if(s){({propertyName:e,propertyDescriptor:t}=s);let i=t.value;if("function"==typeof i)switch(i.name){case"$install":case"$uninstall":case"$enable":case"$disable":case"$state":break;default:t.value=ve(i).beforeAll((function(){if(!this.$.states.enabled&&"PHASE_NONE"===this.$.service.phase){let e=new Q({owner:this,target:i,reason:"component disabled"});throw this.$logErr(...e),e}}))}return{propertyName:e,propertyDescriptor:t}}}})}Le.CACHE=new WeakMap,Le.EXCLUDES=["constructor","prototype","length","size"];class je{constructor(e){je.inject(this,je,e)}static inject(e,t,s){Ne(e,t).use(Fe.TraitCore).use(Fe.TraitAbout,{name:s}).use(Fe.TraitLog).use(Fe.TraitEvents).use(Fe.TraitState).use(Fe.TraitService).use(Fe.TraitTask)}}class Ie extends je{constructor(e){super(e),Ie.inject(this,Ie)}static inject(e,t){Ne(e,t).use(Fe.TraitFetch).use(Fe.TraitDOM).use(Fe.TraitCSS).use(Fe.TraitMutation).use(Fe.TraitTimeout).use(Fe.TraitInterval).use(Fe.TraitLibVue).use(Fe.TraitLibReact)}}const Fe=(e,t)=>Object.assign(new Ie(e),t);class ke{trait_constructor(){const e=this;class t extends Map{constructor(...e){super(...e),Object.defineProperty(this,"id_autoinc",{value:0,writable:!0})}$registerSync(t,s){let i=Object.defineProperties({},{$value:{value:s},$phaseRemove:{value:Ue.getContextualRemovePhase(e)}});return this.set(t,i),i}$registerAsync(t,s,i){let r=e.$task(s,i.$chain);return i.$chain.then((()=>{r.$chainAutoComplete()})),r.$chain.then((()=>{i.$chain.isCompleted||i.$chainAbort("aborted by task")})),Object.defineProperty(i,"$phaseRemove",{value:r.$phaseRemove}),this.set(t,i),r}$id_resolve(e){if(e.indexOf("?")>=0){let t=++this.id_autoinc;e=e.replace(/\?/g,t)}return e}}const s=Object.assign(Object.create(null),{[ke.SYMBOL_PRIVATE]:Object.create(null),assign:function(e,t,s){ne.assign(this,e,t,s)},createSubMap:()=>new t});Object.defineProperty(this,"$",{value:Object.create(s)}),this.$.assign({tasks:null,requests:null},ne.descriptors.ENUMERABLE_WRITABLE)}}ke.SYMBOL_PRIVATE=Symbol("_");class Ce{trait_constructor(e){ne.assign(this.$,"about",new oe(this,e),ne.descriptors.READONLY)}}class Me{trait_constructor(){let e=Object.assign({label:this.$.about.name},a||{enabled:!1}),t=new Oe(e);Object.defineProperty(this.$,"logger",{value:t}),t.installAccessor("log","$log",this),t.installAccessor("warn","$logWarn",this),t.installAccessor("error","$logErr",this)}}class xe{trait_constructor(){this.$.assign("tasks",this.$.createSubMap(),ne.descriptors.ENUMERABLE)}$task(e,t){if(e=this.$.tasks.$id_resolve(e),r&&(se("$task(id)",e).typeString(),se("$task(executorOrValue)",t).notUndefined(),this.$.tasks.has(e)))throw new Z({target:"$task(id)",given:e});let s,i;return s="function"==typeof t?new ce({name:e,owner:this},t):ce.resolve({name:e,owner:this},t),s.$phaseRemove=Ue.getContextualRemovePhase(this),r&&(i=new Pe,s.$taskMetrics={$dev_timing:i}),s.$chain.then((()=>{r&&i.end(),this.$.tasks.get(e)&&this.$taskRemove(e)})),this.$.tasks.set(e,s),s}$taskRemove(e,t){if(r){if(se("$taskRemove(id)",e).typeString(),t&&se("$taskRemove(reason)",t).typeString(),!this.$.tasks.has(e))throw new ee({target:"$taskRemove(id)",given:e});this.$.tasks.get(e)._called,this.$.tasks.get(e)._called=!0}let s=this.$.tasks.get(e);this.$.tasks.delete(e),s.$chainAbort(t||"$taskRemove()")}$taskRemoveAll(e){r&&se("$taskRemoveAll(removePhase)",e).equalIn(Ue.PHASES);let t=this.$.tasks;if(t.size)for(const[s,i]of t)i.$phaseRemove===e&&this.$taskRemove(s,"$taskRemoveAll("+e+")")}$taskPromiseAll(e=!1){let t=[];if(this.$.tasks.size)for(let s of this.$.tasks.values())e&&(s.$chain.chainConfig.chainAutoComplete=!0),s.$chain.isPending&&t.push(s.$chain);return t.length?Promise.all(t):de.resolve()}}class Be{trait_constructor(){De(this,"events",{custom:new Ae(this),kernel:new Ae(this)},ne.descriptors.NONE);let e=this.$[ke.SYMBOL_PRIVATE].events.custom;Object.defineProperties(this.$,{listeners:{get:e.getDomListeners.bind(e,this.$.about.fingerprint),enumerable:!0},observers:{get:e.getObservers.bind(e),enumerable:!0}})}$on(){this.$[ke.SYMBOL_PRIVATE].events.custom.on(...arguments)}$off(){this.$[ke.SYMBOL_PRIVATE].events.custom.off(...arguments)}$trigger(){return this.$[ke.SYMBOL_PRIVATE].events.custom.trigger(...arguments)}$triggerParallel(){return this.$[ke.SYMBOL_PRIVATE].events.custom.triggerParallel(...arguments)}$notify(e,t){return this.$trigger(e,t).then((()=>this.$[ke.SYMBOL_PRIVATE].events.kernel.trigger(e,t)))}}class He{trait_constructor(){const e=Object.create(null),t=Object.create(null),s=this.$[ke.SYMBOL_PRIVATE].events.kernel;De(this,{states:e,stateRoutes:t},ne.descriptors.READONLY),ne.assign(this.$,"states",new Proxy(e,{set:(e,t,s)=>this.$state(t,s),get:(t,s)=>e[s]}),ne.descriptors.READONLY),s.on("beforeStateChange",((e,s)=>{let i;if(t[s.key]&&t[s.key].before&&(i=t[s.key].before(s.val)))return this.$notify(i)})),s.on("afterStateChange",((e,s)=>{let i;if(t[s.key]&&t[s.key].after&&(i=t[s.key].after(s.val)))return this.$notify(i)}))}$state(e,t,s=!0){return r&&(se("$state(key)",e).typeString(),se("$state(notify)",s).typeBoolean()),new de((async i=>{let n,a=this.$[ke.SYMBOL_PRIVATE].states,o=a[e];e in a&&o===t||(n=s&&this.$notify("beforeStateChange",{key:e,val:t,previousVal:o}),r&&n&&se("beforeStateChange result",n).type(de),n&&!n.$isSettled&&(a[e]=n,await n),void 0===t?delete a[e]:a[e]=t,n=s&&this.$notify("afterStateChange",{key:e,val:t,previousVal:o}),r&&n&&se("afterStateChange result",n).type(de)),n?n.then(i):i()}))}}class Ue{trait_constructor(){ne.assign(this.$,"service",Object.create(null),ne.descriptors.READONLY),this.$.service.phase=Ue.PHASE.NONE,this.$.service.phaseQueue=ce.resolve({name:"phaseQueue"},null),this.$.service.phaseTask=null,this.$.service.phaseMap={install:new Set,enable:new Set,disable:new Set,uninstall:new Set},this.$state("installed",!1,!1),this.$state("enabled",!1,!1),Je(this,"stateRoutes",{installed:{after:e=>e?"install":"uninstall"},enabled:{after:e=>e?"enable":"disable"}},ne.descriptors.NONE);let e=this.$[ke.SYMBOL_PRIVATE].events.custom,t=this.$[ke.SYMBOL_PRIVATE].events.kernel;e.affiliateAddRule(((e,t,s,i)=>Ue.setEventNamespaceRemovePhase(this,t,i)));let s=e=>{this.$.tasks.size&&this.$taskRemoveAll(this.$.service.phase);let t=de.resolve();return e&&(t=t.then((()=>e.call(this))).then((()=>this.$taskPromiseAll(!0)))),t.catch((e=>{e instanceof K||this.$logErr("unhandled promise rejection in "+this.$.service.phase+";",...e instanceof W?e:[e])}))};t.on("install",(()=>s(this.onInstall))),t.on("enable",(()=>s(this.onEnable))),t.on("disable",(()=>s(this.onDisable))),t.on("uninstall",(()=>s(this.onUninstall))),t.on("disable",(()=>this.$off({removal:Ue.PHASE.DISABLE}))),t.on("uninstall",(()=>this.$off({removal:Ue.PHASE.UNINSTALL})))}$install(e){let t;const s=new ce({name:"install",config:{chainAutoComplete:!0}},(e=>t=e)).then((()=>{if(!this.$.states.installed)return this.$.service.phase=Ue.PHASE.INSTALL,this.$state("installed",!0)}));return this.$.service.phaseMap.install.add(s),s.$chain.then((()=>{this.$.service.phaseTask=null,this.$.service.phaseMap.install.delete(s),this.$.service.phase=Ue.PHASE.NONE})),this.$.service.phaseQueue=this.$.service.phaseQueue.then((()=>(this.$.service.phaseTask=s,t(),s.$chain))),e?this.$enable():s}$enable(){let e;const t=new ce({name:"enable",config:{chainAutoComplete:!0}},(t=>e=t)).then((()=>{if(this.$.states.installed&&!this.$.states.enabled)return this.$.service.phase=Ue.PHASE.ENABLE,this.$state("enabled",!0)}));return this.$.service.phaseMap.enable.add(t),t.$chain.then((()=>{this.$.service.phaseTask=null,this.$.service.phaseMap.enable.delete(t),this.$.service.phase=Ue.PHASE.NONE})),this.$.service.phaseQueue=this.$.service.phaseQueue.then((()=>(this.$.service.phaseTask=t,e(),t.$chain))),t}$disable(){let e;const t=new ce({name:"disable",config:{chainAutoComplete:!0}},(t=>e=t)).then((()=>{if(this.$.states.enabled)return this.$.service.phase=Ue.PHASE.DISABLE,this.$state("enabled",!1)}));this.$.service.phaseMap.disable.add(t),t.$chain.then((()=>{this.$.service.phaseTask=null,this.$.service.phaseMap.disable.delete(t),this.$.service.phase=Ue.PHASE.NONE}));for(let[e,t]of this.$.service.phaseMap.enable.entries())t===this.$.service.phaseTask&&Ue.phaseKill(this),t.$chainAbort(),this.$.service.phaseMap.enable.delete(e);return this.$.service.phaseQueue=this.$.service.phaseQueue.then((()=>(this.$.service.phaseTask=t,e(),t.$chain))),t}$uninstall(){let e;const t=new ce({name:"uninstall",config:{chainAutoComplete:!0}},(t=>e=t)).then((()=>{if(this.$.states.installed)return this.$.service.phase=Ue.PHASE.UNINSTALL,this.$state("installed",!1)}));this.$.service.phaseMap.uninstall.add(t),t.$chain.then((()=>{this.$.service.phaseTask=null,this.$.service.phaseMap.uninstall.delete(t),this.$.service.phase=Ue.PHASE.NONE}));for(let[e,t]of this.$.service.phaseMap.install.entries())t===this.$.service.phaseTask&&Ue.phaseKill(this),t.$chainAbort(),this.$.service.phaseMap.install.delete(e);return this.$disable(),this.$.service.phaseQueue=this.$.service.phaseQueue.then((()=>(this.$.service.phaseTask=t,e(),t.$chain))),t}static phaseKill(e){e.$.tasks.size&&e.$taskRemoveAll(Ue.getContextualRemovePhase(e)),e.$.service.phase=Ue.PHASE.NONE}static getContextualRemovePhase(e){return Ue.PHASE_REVERT[e.$.service.phase]}static setEventNamespaceRemovePhase(e,t,s){let i=t.hasNamespace(Ue.PHASES),r=s&&s.removal;r||(r=Ue.getContextualRemovePhase(e)),"uninstall"===t.event&&r===Ue.PHASE.DISABLE&&(r=Ue.PHASE.UNINSTALL),i!==r&&(t.deleteNamespace(i),t.addNamespace(r)),t.addNamespace(r)}}function De(e,t,s,i){ne.assign(e.$[ke.SYMBOL_PRIVATE],t,s,i)}function Je(e,t,s,i){ne.assign(e.$[ke.SYMBOL_PRIVATE][t],s,i)}Ue.PHASE={NONE:"PHASE_NONE",INSTALL:"PHASE_INSTALL",ENABLE:"PHASE_ENABLE",DISABLE:"PHASE_DISABLE",UNINSTALL:"PHASE_UNINSTALL"},Ue.PHASE_REVERT={[Ue.PHASE.INSTALL]:Ue.PHASE.UNINSTALL,[Ue.PHASE.UNINSTALL]:Ue.PHASE.INSTALL,[Ue.PHASE.DISABLE]:Ue.PHASE.ENABLE,[Ue.PHASE.ENABLE]:Ue.PHASE.DISABLE,[Ue.PHASE.NONE]:Ue.PHASE.DISABLE},Ue.PHASES=Object.values(Ue.PHASE),Fe.PHASE=ne.disinherit(Ue.PHASE),Fe.TraitCore=ke,Fe.TraitAbout=Ce,Fe.TraitLog=Me,Fe.TraitEvents=Be,Fe.TraitState=He,Fe.TraitService=Ue,Fe.TraitTask=xe;class Ye{trait_constructor(){const e=this.$[ke.SYMBOL_PRIVATE].events.kernel;e.on("disable",(()=>this.$fetchRemoveAll(Ue.PHASE.DISABLE))),e.on("uninstall",(()=>this.$fetchRemoveAll(Ue.PHASE.UNINSTALL))),this.$.assign("requests",this.$.createSubMap(),ne.descriptors.ENUMERABLE)}$fetch(e,t,s={}){if(e=this.$.requests.$id_resolve(e),r&&(se("$fetch(id)",e).typeString(),se("$fetch(url)",t).typeString(),se("$fetch(fetchOptions)",s).typePlainObject(),this.$.requests.has(e)))throw new Z({target:"$fetch(id)",given:e});let i=new Re({name:e,traceSource:V.captureTraceSource("$fetch"),config:{chainAutoComplete:!0}},t,s);return this.$.requests.$registerAsync(e,'$fetch("'+e+'")',i),i.$chain.then((()=>{this.$.requests.has(e)&&this.$fetchRemove(e)})),i}$fetchText(e,t,s={}){return this.$fetch(e,t,{...s,$typeText:!0})}$fetchJSON(e,t,s={}){return this.$fetch(e,t,{...s,$typeJSON:!0})}$fetchRemove(e,t){if(r){if(se("$fetchRemove(id)",e).typeString(),t&&se("$fetchRemove(reason)",t).typeString(),!this.$.requests.has(e))throw new ee({target:"$fetchRemove(id)",given:e});this.$.requests.get(e)._debug_remove_called,this.$.requests.get(e)._debug_remove_called=!0}let s=this.$.requests.get(e);this.$.requests.delete(e),s.$chainAbort(t||"$fetchRemove()")}$fetchRemoveAll(e){r&&se("removePhase",e).equalIn(Ue.PHASES);let t=this.$.requests;if(t.size)for(const[s,i]of t)i.$phaseRemove===e&&this.$fetchRemove(s,"$fetchRemoveAll("+e+")")}}class Ve{trait_constructor(){const e=this.$[ke.SYMBOL_PRIVATE].events.kernel;e.on("disable",(()=>this.$timeoutRemoveAll(Ue.PHASE.DISABLE))),e.on("uninstall",(()=>this.$timeoutRemoveAll(Ue.PHASE.UNINSTALL))),this.$.assign("timeouts",this.$.createSubMap(),ne.descriptors.ENUMERABLE)}$timeout(e,t,s=null,...i){if(e=this.$.timeouts.$id_resolve(e),r&&(se("id",e).typeString(),se("delay",t).typeNumber(),se("handler",s).type(Function,null),this.$.timeouts.has(e)))throw new Z({target:"$timeout(id)",given:e});let n,a=new ce({name:e,traceSource:V.captureTraceSource("$timeout"),config:{chainAutoComplete:!0}},(e=>{n=setTimeout((()=>{a.$isExpired||e(s?s(...i):void 0)}),t)}));return a.$chain.data.timer=n,this.$.timeouts.$registerAsync(e,'$timeout("'+e+'")',a),a.$chain.then((()=>{this.$.timeouts.has(e)&&this.$timeoutRemove(e)})),a}$timeoutRemove(e,t){if(r){if(se("$timeoutRemove(id)",e).typeString(),t&&se("$timeoutRemove(reason)",t).typeString(),!this.$.timeouts.has(e))throw new ee({target:"$timeoutRemove(id)",given:e});this.$.timeouts.get(e)._debug_remove_called,this.$.timeouts.get(e)._debug_remove_called=!0}let s=this.$.timeouts.get(e);clearTimeout(s.$chain.data.timer),this.$.timeouts.delete(e),s.$chainAbort(t||"$timeoutRemove()")}$timeoutRemoveAll(e){r&&se("removePhase",e).equalIn(Ue.PHASES);let t=this.$.timeouts;if(t.size)for(const[s,i]of t)i.$phaseRemove===e&&this.$timeoutRemove(s,"$timeoutRemoveAll()")}}class qe{trait_constructor(){const e=this.$[ke.SYMBOL_PRIVATE].events.kernel;e.on("disable",(()=>this.$intervalRemoveAll(Ue.PHASE.DISABLE))),e.on("uninstall",(()=>this.$intervalRemoveAll(Ue.PHASE.UNINSTALL))),this.$.assign("timeints",this.$.createSubMap(),ne.descriptors.ENUMERABLE)}$interval(e,t,s,...i){if(e=this.$.timeints.$id_resolve(e),r&&(se("id",e).typeString(),se("handler",s).typeFunction(),se("delay",t).typeNumber(),this.$.timeints.has(e)))throw new Z({target:"$interval(id)",given:e});let n=setInterval(s,t,...i);this.$.timeints.$registerSync(e,n)}$intervalRemove(e){if(r){if(se("$intervalRemove(id)",e).typeString(),!this.$.timeints.has(e))throw new ee({target:"$intervalRemove(id)",given:e});this.$.timeints.get(e)._debug_remove_called,this.$.timeints.get(e)._debug_remove_called=!0}clearInterval(this.$.timeints.get(e).$value),this.$.timeints.delete(e)}$intervalRemoveAll(e){r&&se("removePhase",e).equalIn(Ue.PHASES);let t=this.$.timeints;if(t.size)for(const[s,i]of t)i.$phaseRemove===e&&this.$intervalRemove(s)}}r&&k(I);class We{trait_constructor(){const e=this.$[ke.SYMBOL_PRIVATE].events.kernel;e.on("disable",(()=>this.$mutationRemoveAll(Ue.PHASE.DISABLE))),e.on("uninstall",(()=>this.$mutationRemoveAll(Ue.PHASE.UNINSTALL))),this.$.assign("mutations",this.$.createSubMap(),ne.descriptors.ENUMERABLE)}$mutation(e,t,s,i){if(e=this.$.mutations.$id_resolve(e),r&&(se("id",e).typeString(),se("parent",t).type(HTMLElement,Document),se("config",s).typePlainObject(),se("handler",i).typeFunction(),this.$.mutations.has(e)))throw new Z({target:"$mutation(id)",given:e});let n=new MutationObserver(i);n.observe(t,s),this.$.mutations.$registerSync(e,n)}$mutationRemove(e,t){if(r){if(se("$mutationRemove(id)",e).typeString(),t&&se("$mutationRemove(reason)",t).typeString(),!this.$.mutations.has(e))throw new ee({target:"$mutationRemove(id)",given:e});this.$.mutations.get(e)._debug_remove_called,this.$.mutations.get(e)._debug_remove_called=!0}this.$.mutations.get(e).$value.disconnect(),this.$.mutations.delete(e)}$mutationRemoveAll(e){r&&se("removePhase",e).equalIn(Ue.PHASES);let t=this.$.mutations;if(t.size)for(const[s,i]of t)i.$phaseRemove===e&&this.$mutationRemove(s)}}class Ge{trait_constructor(){const e=this.$[ke.SYMBOL_PRIVATE].events.kernel;e.on("disable",(()=>this.$domRemoveAll(Ue.PHASE.DISABLE))),e.on("uninstall",(()=>this.$domRemoveAll(Ue.PHASE.UNINSTALL))),this.$.assign("dom",this.$.createSubMap(),ne.descriptors.ENUMERABLE)}$dom(e,t,s){let i;if(e=this.$.dom.$id_resolve(e),r&&(se("id",e).typeString(),se("jQueryArgument",t).type(String,Object),s&&se("appendTo",s).type(String,Object)),"#"===e[0]&&(e=e.substring(1),i=!0),r&&this.$.dom.has(e))throw new Z({target:"$dom(id)",given:e});let n=p(t);if("TEMPLATE"===n[0].tagName&&(n=p(p(n[0]).html())),i){if(r&&n[0].nodeType!==Node.ELEMENT_NODE)throw new z({target:"$dom(#id)",given:n,reason:"cannot set the dom id: the first element of the selection isn't an ELEMENT_NODE"});n[0].id=e}return s&&n.appendTo(s),this.$.dom.$registerSync(e,n).$value}$domFetch(e,t,s,i){let n;if(s&&!$(s)&&([s,i]=[{},s]),e=this.$.dom.$id_resolve(e),r&&(se("id",e).typeString(),se("url",t).typeString(),i&&se("appendTo",i).type(String,Object),s&&se("fetchOptions",s).type(Object)),"#"===e[0]&&(e=e.substring(1),n=!0),r&&this.$.dom.has(e))throw new Z({target:"$domFetch(id)",given:e});let a=this.$fetchText('$domFetch("'+e+'")',t,s).then((t=>{let s=p(t);return n&&(s[0].id=e),i&&s.appendTo(i),s}));return this.$.dom.$registerAsync(e,'$domFetch("'+e+'")',a),a}$domRemove(e,t){if(r){if(se("$domRemove(id)",e).typeString(),t&&se("$domRemove(reason)",t).typeString(),!this.$.dom.has(e))throw new ee({target:"$domRemove(id)",given:e});this.$.dom.get(e)._debug_remove_called,this.$.dom.get(e)._debug_remove_called=!0}let s=this.$.dom.get(e),i=s.$value;i instanceof p&&i.remove(),s instanceof Re&&s.$chainAbort(t||"$domRemove()"),this.$.dom.delete(e)}$domRemoveAll(e){r&&se("removePhase",e).equalIn(Ue.PHASES);let t=this.$.dom;if(t.size)for(const[s,i]of t)i.$phaseRemove===e&&this.$domRemove(s)}}class ze{trait_constructor(){const e=this.$[ke.SYMBOL_PRIVATE].events.kernel;e.on("disable",(()=>this.$cssRemoveAll(Ue.PHASE.DISABLE))),e.on("uninstall",(()=>this.$cssRemoveAll(Ue.PHASE.UNINSTALL))),this.$.assign("css",this.$.createSubMap(),ne.descriptors.ENUMERABLE)}$css(e,t){let s;if(e=this.$.css.$id_resolve(e),r&&(se("id",e).typeString(),se("css",t).typeString()),"#"===e[0]&&(e=e.substring(1),s=!0),r&&this.$.css.has(e))throw new Z({target:"$css(id)",given:e});return this.$.css.$registerSync(e,p("<style>").attr(s?{id:e}:{}).html(t).appendTo("head")).$value}$cssFetch(e,t,s="head"){let i;if(e=this.$.css.$id_resolve(e),r&&(se("id",e).typeString(),se("url",t).typeString()),"#"===e[0]&&(e=e.substring(1),i=!0),r&&this.$.css.has(e))throw new Z({target:"$cssFetch(id)",given:e});t=_(t);let n=p(s).find(`link[href="${t}"]`)[0];if(n){n.dataset.usage=parseInt(n.dataset.usage)+1;let t=p(n),s=ce.resolve({name:e,config:{chainAutoComplete:!0},traceSource:V.captureTraceSource("$cssFetch")},t);return s.$chain.data.dom=t,this.$.css.$registerAsync(e,'$cssFetch("'+e+'")',s),s}{let r,n=new ce({name:e,config:{chainAutoComplete:!0},traceSource:V.captureTraceSource("$cssFetch")},(n=>r=p("<link>",{id:i?e:"",rel:"stylesheet",type:"text/css","data-usage":"1"}).appendTo(s).on("load",(()=>n(r))).attr("href",t)));return n.$chain.data.dom=r,this.$.css.$registerAsync(e,'$cssFetch("'+e+'")',n),n}}$cssRemove(e,t){if(r){if(se("$cssRemove(id)",e).typeString(),t&&se("$cssRemove(reason)",t).typeString(),!this.$.css.has(e))throw new ee({target:"$cssRemove(id)",given:e});this.$.css.get(e)._debug_remove_called,this.$.css.get(e)._debug_remove_called=!0}let s=this.$.css.get(e),i=s.$chain&&s.$chain.data.dom||s.$value;if(i instanceof p){let e=parseInt(i[0].dataset.usage)-1;e?i[0].dataset.usage=e:i.remove()}s instanceof ce&&s.$chainAbort(t||"$cssRemove()"),this.$.css.delete(e)}$cssRemoveAll(e){r&&se("removePhase",e).equalIn(Ue.PHASES);let t=this.$.css;if(t.size)for(const[s,i]of t)i.$phaseRemove===e&&this.$cssRemove(s)}}class Qe{trait_constructor(){const e=this.$[ke.SYMBOL_PRIVATE].events.kernel;e.on("disable",(()=>this.$vueRemoveAll(Ue.PHASE.DISABLE))),e.on("uninstall",(()=>this.$vueRemoveAll(Ue.PHASE.UNINSTALL))),this.$.assign("vue",this.$.createSubMap(),ne.descriptors.ENUMERABLE)}$vue(e,t){if(e=this.$.vue.$id_resolve(e),r&&(se("id",e).typeString(),se("vue",t).type(Object)),r&&this.$.vue.has(e))throw new Z({target:"$vue(id)",given:e});return this.$.vue.$registerSync(e,t).$value}$vueRemove(e){if(r){if(se("$vueRemove(id)",e).typeString(),!this.$.vue.has(e))throw new ee({target:"$vueRemove(id)",given:e});this.$.vue.get(e)._debug_remove_called,this.$.vue.get(e)._debug_remove_called=!0}let t=this.$.vue.get(e);p(t.$value.$el).remove(),t.$value.$destroy(),this.$.vue.delete(e)}$vueRemoveAll(e){r&&se("removePhase",e).equalIn(Ue.PHASES);let t=this.$.vue;if(t.size)for(const[s,i]of t)i.$phaseRemove===e&&this.$vueRemove(s)}}class Ke{trait_constructor(){const e=this.$[ke.SYMBOL_PRIVATE].events.kernel;e.on("disable",(()=>this.$reactRemoveAll(Ue.PHASE.DISABLE))),e.on("uninstall",(()=>this.$reactRemoveAll(Ue.PHASE.UNINSTALL))),this.$.assign("react",this.$.createSubMap(),ne.descriptors.ENUMERABLE)}$react(e,t,s,...i){if(e=this.$.react.$id_resolve(e),r){if(!Fe.ReactDOM)throw new Error("jFactory.ReactDOM=ReactDOM must be set before using the React Trait");se("id",e).typeString(),se("container",t).type(HTMLElement,p)}if(r&&this.$.react.has(e))throw new Z({target:"$react(id)",given:e});t=p(t)[0];let n=Fe.ReactDOM.render(s,t,...i);return this.$.react.$registerSync(e,{container:t,view:n}).$value.view}$reactRemove(e){if(r){if(se("$reactRemove(id)",e).typeString(),!this.$.react.has(e))throw new ee({target:"$reactRemove(id)",given:e});this.$.react.get(e)._debug_remove_called,this.$.react.get(e)._debug_remove_called=!0}let t=this.$.react.get(e).$value.container;t&&(Fe.ReactDOM.unmountComponentAtNode(t)||r&&this.$logWarn("unmountComponentAtNode failed to unmount",t),p(t).remove()),this.$.react.delete(e)}$reactRemoveAll(e){r&&se("removePhase",e).equalIn(Ue.PHASES);let t=this.$.react;if(t.size)for(const[s,i]of t)i.$phaseRemove===e&&this.$reactRemove(s)}}Fe.TraitFetch=Ye,Fe.TraitTimeout=Ve,Fe.TraitInterval=qe,Fe.TraitMutation=We,Fe.TraitDOM=Ge,Fe.TraitCSS=ze,Fe.TraitLibVue=Qe,Fe.TraitLibReact=Ke,M(!0);export{l as JFACTORY_BOOT,u as JFACTORY_CFG,i as JFACTORY_CLI,j as JFACTORY_COMPAT_AbortController,I as JFACTORY_COMPAT_MutationObserver,N as JFACTORY_COMPAT_Request,L as JFACTORY_COMPAT_fetch,n as JFACTORY_DEBUG,r as JFACTORY_DEV,Q as JFACTORY_ERR_INVALID_CALL,z as JFACTORY_ERR_INVALID_VALUE,Z as JFACTORY_ERR_KEY_DUPLICATED,ee as JFACTORY_ERR_KEY_MISSING,K as JFACTORY_ERR_PROMISE_EXPIRED,X as JFACTORY_ERR_REQUEST_ERROR,a as JFACTORY_LOG,o as JFACTORY_TRACE,s as JFACTORY_VER,oe as JFactoryAbout,Ie as JFactoryComponent,je as JFactoryCoreObject,W as JFactoryError,Se as JFactoryEventSelector,ye as JFactoryEventSelectorParser,Ee as JFactoryEvents,Ae as JFactoryEventsManager,se as JFactoryExpect,Re as JFactoryFetch,pe as JFactoryFunctionComposer,ge as JFactoryFunctionConditional,me as JFactoryFunctionExpirable,be as JFactoryFunctionWrappable,Oe as JFactoryLogger,ne as JFactoryObject,ce as JFactoryPromise,he as JFactoryPromiseChain,ue as JFactoryPromisePath,de as JFactoryPromiseSync,Te as JFactoryTime,Pe as JFactoryTimeTrace,J as JFactoryTrace,Y as JFactoryTrace_LIB_STACKTRACE,Le as JFactoryTraits,y as NOOP,Ce as TraitAbout,ze as TraitCSS,ke as TraitCore,Ge as TraitDOM,Be as TraitEvents,Ye as TraitFetch,qe as TraitInterval,Ke as TraitLibReact,Qe as TraitLibVue,Me as TraitLog,We as TraitMutation,Ue as TraitService,He as TraitState,xe as TraitTask,Ve as TraitTimeout,De as assignPrivate,Je as assignPrivateMember,A as helper_camelCase,g as helper_defaultsDeep,T as helper_deferred,b as helper_get,O as helper_isNative,m as helper_isNumber,$ as helper_isPlainObject,f as helper_isString,v as helper_lowerFirst,S as helper_setFunctionName,E as helper_template,_ as helper_url_abs,w as helper_useragent,Fe as jFactory,M as jFactoryBootstrap,U as jFactoryBootstrap_expected,D as jFactoryBootstrap_onBoot,h as jFactoryCfg,k as jFactoryCompat_require,C as jFactoryCompat_run,c as jFactoryEnv,$e as jFactoryFunctionConditional,fe as jFactoryFunctionExpirable,ve as jFactoryFunctionWrappable,V as jFactoryTrace,Ne as jFactoryTraits,p as jQuery};
